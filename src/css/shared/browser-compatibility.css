/* ============================================
   BROWSER COMPATIBILITY & FALLBACKS
   ============================================ */

/* 1. CSS Resets for cross-browser consistency */
*,
*::before,
*::after {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

/* 2. Smooth scroll with fallback */
html {
    scroll-behavior: smooth;
}

/* Disable smooth scroll for users who prefer reduced motion */
@media (prefers-reduced-motion: reduce) {
    html {
        scroll-behavior: auto;
    }
    
    *,
    *::before,
    *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
    }
}

/* 3. Fix for older browsers that don't support CSS variables */
.no-css-variables {
    /* Fallback values when CSS variables aren't supported */
    --color-primary: #030C44;
    --color-accent: #89D1D1;
    --color-bg: #ffffff;
    --color-text: #333333;
}

/* 4. Flexbox fallbacks for older browsers */
.flex-container {
    display: -webkit-box;      /* OLD - iOS 6-, Safari 3.1-6 */
    display: -moz-box;         /* OLD - Firefox 19- */
    display: -ms-flexbox;      /* TWEENER - IE 10 */
    display: -webkit-flex;     /* NEW - Chrome */
    display: flex;             /* NEW, Spec - Opera 12.1, Firefox 20+ */
}

/* 5. Grid fallbacks for older browsers */
@supports not (display: grid) {
    .grid-container {
        display: flex;
        flex-wrap: wrap;
    }
    
    .grid-item {
        flex: 0 0 calc(33.333% - 20px);
        margin: 10px;
    }
}

/* 6. Object-fit fallbacks for IE */
@media screen and (-ms-high-contrast: active), (-ms-high-contrast: none) {
    img {
        width: 100%;
        height: auto;
    }
}

/* 7. Sticky positioning fallback */
@supports not (position: sticky) {
    .sticky-element {
        position: relative;
    }
}

/* 8. CSS Grid with fallback */
.card-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
}

/* Fallback for browsers that don't support grid */
@supports not (display: grid) {
    .card-container {
        display: flex;
        flex-wrap: wrap;
        margin: -10px;
    }
    
    .card {
        flex: 0 0 calc(33.333% - 20px);
        margin: 10px;
    }
}

/* 9. Backdrop filter fallback */
.backdrop-blur {
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
}

/* Fallback for browsers that don't support backdrop-filter */
@supports not (backdrop-filter: blur(10px)) {
    .backdrop-blur {
        background: rgba(255, 255, 255, 0.9);
    }
}

/* 10. Aspect ratio fallback */
.aspect-ratio-16-9 {
    aspect-ratio: 16 / 9;
}

@supports not (aspect-ratio: 16 / 9) {
    .aspect-ratio-16-9 {
        position: relative;
        padding-bottom: 56.25%; /* 16:9 ratio */
    }
    
    .aspect-ratio-16-9 > * {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }
}

/* 11. Modern image formats with fallback */
.modern-image {
    background-image: url('image.jpg');
}

.webp .modern-image {
    background-image: url('image.webp');
}

.avif .modern-image {
    background-image: url('image.avif');
}

/* 12. Focus visible for accessibility */
:focus-visible {
    outline: 2px solid var(--color-accent, #89D1D1);
    outline-offset: 2px;
}

/* Fallback for older browsers */
:focus {
    outline: 2px solid var(--color-accent, #89D1D1);
    outline-offset: 2px;
}

/* Remove focus outline for mouse users */
:focus:not(:focus-visible) {
    outline: none;
}

/* 13. Vendor prefixes for transforms */
.transform-element {
    -webkit-transform: translateX(0);
    -moz-transform: translateX(0);
    -ms-transform: translateX(0);
    transform: translateX(0);
    
    -webkit-transition: transform 0.3s ease;
    -moz-transition: transform 0.3s ease;
    -ms-transition: transform 0.3s ease;
    transition: transform 0.3s ease;
}

/* 14. Vendor prefixes for filters */
.filter-element {
    -webkit-filter: blur(5px);
    -moz-filter: blur(5px);
    -ms-filter: blur(5px);
    filter: blur(5px);
}

/* 15. Print styles */
@media print {
    *,
    *::before,
    *::after {
        background: transparent !important;
        color: #000 !important;
        box-shadow: none !important;
        text-shadow: none !important;
    }
    
    a,
    a:visited {
        text-decoration: underline;
    }
    
    a[href]::after {
        content: " (" attr(href) ")";
    }
    
    img {
        max-width: 100% !important;
        page-break-inside: avoid;
    }
    
    h2,
    h3 {
        page-break-after: avoid;
    }
    
    .no-print {
        display: none !important;
    }
}

/* 16. High contrast mode support */
@media (prefers-contrast: high) {
    :root {
        --color-text: #000000;
        --color-bg: #ffffff;
    }
    
    button,
    .btn {
        border: 2px solid currentColor;
    }
}

/* 17. Dark mode support */
@media (prefers-color-scheme: dark) {
    :root {
        --color-bg: #1a1a1a;
        --color-text: #f0f0f0;
        --color-primary: #89D1D1;
        --color-accent: #030C44;
    }
}

/* 18. Safe area insets for notched devices (iPhone X+) */
@supports (padding: env(safe-area-inset-left)) {
    .safe-area-padding {
        padding-left: env(safe-area-inset-left);
        padding-right: env(safe-area-inset-right);
        padding-top: env(safe-area-inset-top);
        padding-bottom: env(safe-area-inset-bottom);
    }
}

/* 19. Clamp fallback */
.responsive-text {
    font-size: clamp(1rem, 2vw, 2rem);
}

@supports not (font-size: clamp(1rem, 2vw, 2rem)) {
    .responsive-text {
        font-size: calc(1rem + 1vw);
    }
}

/* 20. Container queries fallback */
@supports not (container-type: inline-size) {
    /* Use media queries instead of container queries */
    @media (min-width: 768px) {
        .responsive-container > * {
            flex-direction: row;
        }
    }
}

/* 21. Loading states for images */
img {
    background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
    background-size: 200% 100%;
}

img[loading="lazy"]:not([src]) {
    animation: shimmer 1.5s infinite;
}

@keyframes shimmer {
    0% {
        background-position: 200% 0;
    }
    100% {
        background-position: -200% 0;
    }
}

/* 22. Scroll snap fallback */
.scroll-container {
    scroll-snap-type: y mandatory;
    -webkit-scroll-snap-type: y mandatory;
}

.scroll-item {
    scroll-snap-align: start;
    -webkit-scroll-snap-align: start;
}

@supports not (scroll-snap-type: y mandatory) {
    .scroll-container {
        overflow-y: scroll;
    }
}

/* 23. Browser-specific fixes */

/* IE 10-11 */
@media all and (-ms-high-contrast: none), (-ms-high-contrast: active) {
    .flex-container {
        display: -ms-flexbox;
    }
    
    img {
        width: 100%;
        height: auto;
    }
}

/* Edge Legacy */
@supports (-ms-ime-align: auto) {
    .edge-fix {
        /* Edge-specific fixes here */
    }
}

/* Safari */
@supports (-webkit-appearance: none) {
    .safari-fix {
        /* Safari-specific fixes here */
    }
}

/* Firefox */
@-moz-document url-prefix() {
    .firefox-fix {
        /* Firefox-specific fixes here */
    }
}

/* 24. Reduced transparency for accessibility */
@media (prefers-reduced-transparency: reduce) {
    * {
        backdrop-filter: none !important;
        background: solid !important;
    }
}

/* 25. Input autocomplete background fix */
input:-webkit-autofill,
input:-webkit-autofill:hover,
input:-webkit-autofill:focus {
    -webkit-box-shadow: 0 0 0 1000px var(--color-bg, white) inset;
    -webkit-text-fill-color: var(--color-text, #333);
}
